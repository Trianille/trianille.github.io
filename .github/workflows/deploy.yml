name: Deploy Static Website

on:
  push:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Generate Firebase config
        run: |
          # Ð£Ð´Ð°Ð»ÑÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ ÐºÐ¾Ð½Ñ„Ð¸Ð³ ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ
          rm -f firebase-config.js
          
          # Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð½Ð¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð½Ñ„Ð¸Ð³
          cat > firebase-config.js << 'EOF'
          // AUTO-GENERATED - DO NOT EDIT
          const firebaseConfig = {
            apiKey: "${{ secrets.FIREBASE_API_KEY }}",
            authDomain: "${{ secrets.FIREBASE_AUTH_DOMAIN }}",
            projectId: "${{ secrets.FIREBASE_PROJECT_ID }}",
            storageBucket: "${{ secrets.FIREBASE_STORAGE_BUCKET }}",
            messagingSenderId: "${{ secrets.FIREBASE_MESSAGING_SENDER_ID }}",
            appId: "${{ secrets.FIREBASE_APP_ID }}",
            measurementId: "${{ secrets.FIREBASE_MEASUREMENT_ID }}"
          };
          
          // Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Firebase
          firebase.initializeApp(firebaseConfig);
          const db = firebase.firestore();
          const auth = firebase.auth();
          EOF
          
          echo "âœ… Firebase config created"
          echo "ðŸ“ Files in directory:"
          ls -la
      
      - name: Verify HTML structure
        run: |
          if [ -f "index.html" ]; then
            echo "âœ… index.html found"
            # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ firebase-config.js
            if grep -q "firebase-config.js" index.html; then
              echo "âœ… firebase-config.js is linked in index.html"
            else
              echo "âš ï¸  WARNING: firebase-config.js not found in index.html"
            fi
          else
            echo "âŒ ERROR: index.html not found!"
            exit 1
          fi
      
      - name: Setup Pages
        uses: actions/configure-pages@v3
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v2
        with:
          path: "."

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v2